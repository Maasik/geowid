(function(){var b,f;"undefined"!=typeof exports?b=exports:(b={},f=window.R,b.noConflict=function(){window.R=f;return b},window.R=b);b.version="0.1.2x";b.Layer=L.Class.extend({includes:L.Mixin.Events,initialize:function(){},onAdd:function(a){this._map=a;this._map._initRaphaelRoot();this._paper=this._map._paper;this._set=this._paper.set();a.on("viewreset",this.projectLatLngs,this);this.projectLatLngs()},onRemove:function(a){a.off("viewreset",this.projectLatLngs,this);this._map=null;this._set.forEach(function(a){a.remove()},
this);this._set.clear()},projectLatLngs:function(){},animate:function(a,c,g,b){this._set.animate(a,c,g,b);return this},hover:function(a,c,b,d){this._set.hover(a,c,b,d);return this},attr:function(a,c){this._set.attr(a,c);return this}});L.Map.include({_initRaphaelRoot:function(){this._raphaelRoot||(this._raphaelRoot=this._panes.overlayPane,this._paper=Raphael(this._raphaelRoot),this.on("moveend",this._updateRaphaelViewport),this._updateRaphaelViewport())},_updateRaphaelViewport:function(){var a=this.getSize(),
c=L.DomUtil.getPosition(this._mapPane).multiplyBy(-1)._subtract(a.multiplyBy(0.02)),b=c.add(a.multiplyBy(1.04)),a=b.x-c.x,b=b.y-c.y,d=this._raphaelRoot;this._paper.setSize(a,b);L.DomUtil.setPosition(d,c);d.setAttribute("width",a);d.setAttribute("height",b);this._paper.setViewBox(c.x,c.y,a,b,!1)}});b.PulseLayer=b.Layer.extend({_pool:[],_used:[],_add:function(a){for(var c=0;c<a;c++)this._pool.push({point:this._paper.circle(0,0,this._radius).attr({opacity:0}),wave:this._paper.circle(0,0,this._radius).attr({opacity:0,
"stroke-opacity":0})})},pulse:function(a,c,b,d){var e=this._pool.pop();void 0===e&&(this._add(this._addNum),e=this._pool.pop());var f=this._used.length;this._used[f]={data:e,latlng:new L.LatLng(a,c)};a=this._map.latLngToLayerPoint(new L.LatLng(a,c));e.point.attr({fill:b,cx:a.x,cy:a.y});e.wave.attr({fill:b,cx:a.x,cy:a.y});e.point.animate({"0%":{transform:"s0.01"},"10%":{transform:"s1",opacity:0.85,easing:"backOut"},"100%":{transform:"s0.01",opacity:0}},d,function(){this._pool.push(e);this._used.splice(f,
1)});e.wave.animate({"0%":{transform:"s0.01",opacity:0.85},"100%":{transform:"s2",opacity:0,easing:"<"}},0.5*d)},initialize:function(a,c){b.Layer.prototype.initialize.call(this,c);this._poolSize=a;this._radius=5;this._addNum=10},onAdd:function(a){b.Layer.prototype.onAdd.call(this,a);this._add(this._poolSize)},onRemove:function(a){b.Layer.prototype.onRemove.call(this,a);this._paper.clear()},projectLatLngs:function(){for(var a=0;a<this._used.length;a++){var b=this._map.latLngToLayerPoint(this._used[a].latlng);
this._used[a].data.point&&this._used[a].data.point.attr({cx:b.x,cy:b.y});this._used[a].data.wave&&this._used[a].data.wave.attr({cx:b.x,cy:b.y})}}})})();