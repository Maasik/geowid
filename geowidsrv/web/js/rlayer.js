(function(){var d,f;"undefined"!=typeof exports?d=exports:(d={},f=window.R,d.noConflict=function(){window.R=f;return d},window.R=d);d.version="0.1.2x";d.Layer=L.Class.extend({includes:L.Mixin.Events,initialize:function(){},onAdd:function(a){this._map=a;this._map._initRaphaelRoot();this._paper=this._map._paper;this._set=this._paper.set();a.on("viewreset",this.projectLatLngs,this);this.projectLatLngs()},onRemove:function(a){a.off("viewreset",this.projectLatLngs,this);this._map=null;this._set.forEach(function(a){a.remove()},
this);this._set.clear()},projectLatLngs:function(){},animate:function(a,b,e,c){this._set.animate(a,b,e,c);return this},hover:function(a,b,e,c){this._set.hover(a,b,e,c);return this},attr:function(a,b){this._set.attr(a,b);return this}});L.Map.include({_initRaphaelRoot:function(){this._raphaelRoot||(this._raphaelRoot=this._panes.overlayPane,this._paper=Raphael(this._raphaelRoot),this.on("moveend",this._updateRaphaelViewport),this._updateRaphaelViewport())},_updateRaphaelViewport:function(){var a=this.getSize(),
b=L.DomUtil.getPosition(this._mapPane).multiplyBy(-1)._subtract(a.multiplyBy(0.02)),e=b.add(a.multiplyBy(1.04)),a=e.x-b.x,e=e.y-b.y,c=this._raphaelRoot;this._paper.setSize(a,e);L.DomUtil.setPosition(c,b);c.setAttribute("width",a);c.setAttribute("height",e);this._paper.setViewBox(b.x,b.y,a,e,!1)}});d.PulseLayer=d.Layer.extend({_pool:[],_used:[],_add:function(a){for(var b=0;b<a;b++)this._pool.push({point:this._paper.circle(0,0,this._radius).attr({opacity:0}),wave:this._paper.circle(0,0,this._radius).attr({opacity:0,
"stroke-opacity":0})})},pulse:function(a,b,e){var c=this._pool.pop();void 0===c&&(this._add(this._addNum),c=this._pool.pop());var d=this._used.length;this._used[d]={data:c,latlng:new L.LatLng(a,b)};a=this._map.latLngToLayerPoint(new L.LatLng(a,b));c.point.attr({fill:e,cx:a.x,cy:a.y});c.wave.attr({fill:e,cx:a.x,cy:a.y});c.point.animate({"0%":{transform:"s0.01"},"5%":{transform:"s1",opacity:0.85,easing:"backOut"},"90%":{},"100%":{transform:"s0.01",opacity:0}},7E3,function(){this._pool.push(c);this._used.splice(d,
1)});c.wave.animate({"0%":{transform:"s0.01",opacity:0.85},"100%":{transform:"s2",opacity:0,easing:"<"}},1E3)},initialize:function(a,b){d.Layer.prototype.initialize.call(this,b);this._poolSize=a;this._radius=4;this._addNum=10},onAdd:function(a){d.Layer.prototype.onAdd.call(this,a);this._add(this._poolSize)},onRemove:function(a){d.Layer.prototype.onRemove.call(this,a);this._paper.clear()},projectLatLngs:function(){for(var a=0;a<this._used.length;a++){var b=this._map.latLngToLayerPoint(this._used[a].latlng);
this._used[a].data.point&&this._used[a].data.point.attr({cx:b.x,cy:b.y});this._used[a].data.wave&&this._used[a].data.wave.attr({cx:b.x,cy:b.y})}}})})();