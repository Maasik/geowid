(function(){var d,j;"undefined"!=typeof exports?d=exports:(d={},j=window.R,d.noConflict=function(){window.R=j;return d},window.R=d);d.version="0.1.2";d.Layer=L.Class.extend({includes:L.Mixin.Events,initialize:function(){},onAdd:function(a){this._map=a;this._map._initRaphaelRoot();this._paper=this._map._paper;this._set=this._paper.set();a.on("viewreset",this.projectLatLngs,this);this.projectLatLngs()},onRemove:function(a){a.off("viewreset",this.projectLatLngs,this);this._map=null;this._set.forEach(function(a){a.remove()},
this);this._set.clear()},projectLatLngs:function(){},animate:function(a,b,c,e){this._set.animate(a,b,c,e);return this},hover:function(a,b,c,e){this._set.hover(a,b,c,e);return this},attr:function(a,b){this._set.attr(a,b);return this}});L.Map.include({_initRaphaelRoot:function(){this._raphaelRoot||(this._raphaelRoot=this._panes.overlayPane,this._paper=Raphael(this._raphaelRoot),this.on("moveend",this._updateRaphaelViewport),this._updateRaphaelViewport())},_updateRaphaelViewport:function(){var a=this.getSize(),
b=L.DomUtil.getPosition(this._mapPane).multiplyBy(-1)._subtract(a.multiplyBy(0.02)),c=b.add(a.multiplyBy(1.04)),a=c.x-b.x,c=c.y-b.y,e=this._raphaelRoot;this._paper.setSize(a,c);L.DomUtil.setPosition(e,b);e.setAttribute("width",a);e.setAttribute("height",c);this._paper.setViewBox(b.x,b.y,a,c,!1)}});d.Marker=d.Layer.extend({initialize:function(a,b,c,e){d.Layer.prototype.initialize.call(this,e);this._latlng=a;this._pathString="string"==typeof b?b:"M16,3.5c-4.142,0-7.5,3.358-7.5,7.5c0,4.143,7.5,18.121,7.5,18.121S23.5,15.143,23.5,11C23.5,6.858,20.143,3.5,16,3.5z M16,14.584c-1.979,0-3.584-1.604-3.584-3.584S14.021,7.416,16,7.416S19.584,9.021,19.584,11S17.979,14.584,16,14.584z";
this._attr="object"==typeof b?b:c?c:{fill:"#000"}},projectLatLngs:function(){this._path&&this._path.remove();var a=this._map.latLngToLayerPoint(this._latlng),b=Raphael.pathBBox(this._pathString);this._path=this._paper.path(this._pathString).attr(this._attr).translate(a.x-1.05*b.width,a.y-1.15*b.height).toFront();this._set.push(this._path)}});d.Pulse=d.Layer.extend({initialize:function(a,b,c,e,f){d.Layer.prototype.initialize.call(this,f);this._latlng=a;this._radius="number"==typeof b?b:6;this._attr=
"object"==typeof b?b:"object"==typeof c?c:{fill:"#30a3ec",stroke:"#30a3ec"};this._pulseAttr="object"==typeof b?c:"object"==typeof e?e:{"stroke-width":3,stroke:this._attr.stroke};this._repeat=3},onRemove:function(a){d.Layer.prototype.onRemove.call(this,a);this._marker&&this._marker.remove();this._pulse&&this._pulse.remove()},projectLatLngs:function(){this._marker&&this._marker.remove();this._pulse&&this._pulse.remove();var a=this._map.latLngToLayerPoint(this._latlng);this._marker=this._paper.circle(a.x,
a.y,this._radius).attr(this._attr);this._pulse=this._paper.circle(a.x,a.y,this._radius).attr(this._pulseAttr);a=Raphael.animation({"0%":{transform:"s0.3",opacity:1},"100%":{transform:"s3.0",opacity:0,easing:"<"}},1E3);this._pulse.animate(a.repeat(this._repeat))}});d.Polyline=d.Layer.extend({initialize:function(a,b,c){d.Layer.prototype.initialize.call(this,c);this._latlngs=a;this._attr=b||{fill:"#000",stroke:"#000"}},projectLatLngs:function(){this._set.clear();this._path&&this._path.remove();this._path=
this._paper.path(this.getPathString()).attr(this._attr).toBack();this._set.push(this._path)},getPathString:function(){for(var a=0,b=this._latlngs.length,c="";a<b;a++)var e=this._map.latLngToLayerPoint(this._latlngs[a]),c=c+((a?"L":"M")+e.x+" "+e.y);return c}});d.Polygon=d.Layer.extend({initialize:function(a,b,c){d.Layer.prototype.initialize.call(this,c);1==a.length&&a[0]instanceof Array&&(a=a[0]);this._latlngs=a;this._attr=b||{fill:"rgba(255, 0, 0, 0.5)",stroke:"#f00","stroke-width":2}},projectLatLngs:function(){this._path&&
this._path.remove();this._path=this._paper.path(this.getPathString()).attr(this._attr).toBack();this._set.push(this._path)},getPathString:function(){for(var a=0,b=this._latlngs.length,c="";a<b;a++)var e=this._map.latLngToLayerPoint(this._latlngs[a]),c=c+((a?"L":"M")+e.x+" "+e.y);return c+"Z"}});d.PolygonGlow=d.Layer.extend({initialize:function(a,b,c){d.Layer.prototype.initialize.call(this,c);this._latlngs=a;this._attr=b||{fill:"rgba(255, 0, 0, 1)",stroke:"#f00","stroke-width":3}},onRemove:function(a){d.Layer.prototype.onRemove.call(this,
a);this._path&&this._path.remove()},projectLatLngs:function(){this._path&&this._path.remove();var a=this._path=this._paper.path(this.getPathString()).attr(this._attr).toBack(),b=function(){a.animate({"fill-opacity":0.25},1E3,"<",c)},c=function(){a.animate({"fill-opacity":1},1E3,"<",b)};c()},getPathString:function(){for(var a=0,b=this._latlngs.length,c="";a<b;a++)var e=this._map.latLngToLayerPoint(this._latlngs[a]),c=c+((a?"L":"M")+e.x+" "+e.y);return c+"Z"}});d.Bezier=d.Layer.extend({initialize:function(a,
b,c){d.Layer.prototype.initialize.call(this,c);this._latlngs=a;this._attr=b},projectLatLngs:function(){this._path&&this._path.remove();var a=this._map.latLngToLayerPoint(this._latlngs[0]),b=this._map.latLngToLayerPoint(this._latlngs[1]),c=this.getControlPoint(a,b);this._path=this._paper.path("M"+a.x+" "+a.y+"Q"+c.x+" "+c.y+" "+b.x+" "+b.y).attr(this._attr).toBack();this._set.push(this._path)},getControlPoint:function(a,b){var c={x:0,y:0};c.x=a.x+(b.x-[a.x])/2;c.y=a.y+(b.y-[a.y])/2;var e=0;this.closeTo(a.x,
b.x)&&!this.closeTo(a.y,b.y)?(e=1*(a.x-b.x)+15*(a.x>=b.x?1:-1),c.x=Math.max(a.x,b.x)+e):(e=1.5*(b.y-a.y)+15*(a.y<b.y?1:-1),c.y=Math.min(a.y,b.y)+e);return c},closeTo:function(a,b){return-15<a-b&&15>a-b}});d.BezierAnim=d.Layer.extend({initialize:function(a,b,c,e){d.Layer.prototype.initialize.call(this,e);this._latlngs=a;this._attr=b;this._cb=c},onRemove:function(a){d.Layer.prototype.onRemove.call(this,a);this._path&&this._path.remove();this._sub&&this._sub.remove()},projectLatLngs:function(){this._path&&
this._path.remove();this._sub&&this._sub.remove();var a=this,b=this._map.latLngToLayerPoint(this._latlngs[0]),c=this._map.latLngToLayerPoint(this._latlngs[1]),e=this.getControlPoint(b,c),b=this._paper.path("M"+b.x+" "+b.y+"Q"+e.x+" "+e.y+" "+c.x+" "+c.y).hide();this._paper.customAttributes.alongBezier=function(a){var b=this.data("reverse"),c=this.data("pathLength");return{path:this.data("bezierPath").getSubpath(b?(1-a)*c:0,b?c:a*c)}};var d=this._sub=this._paper.path().data("bezierPath",b).data("pathLength",
b.getTotalLength()).data("reverse",!1).attr({stroke:"#f00",alongBezier:0,"stroke-width":3});d.stop().animate({alongBezier:1},500,function(){a._cb();d.data("reverse",!0);d.stop().animate({alongBezier:0},500,function(){d.remove()})})},getControlPoint:function(a,b){var c={x:0,y:0};c.x=a.x+(b.x-[a.x])/2;c.y=a.y+(b.y-[a.y])/2;var d=0;this.closeTo(a.x,b.x)&&!this.closeTo(a.y,b.y)?(d=1*(a.x-b.x)+15*(a.x>=b.x?1:-1),c.x=Math.max(a.x,b.x)+d):(d=1.5*(b.y-a.y)+15*(a.y<b.y?1:-1),c.y=Math.min(a.y,b.y)+d);return c},
closeTo:function(a,b){return-15<a-b&&15>a-b}});d.FeatureGroup=L.FeatureGroup.extend({initialize:function(a,b){L.FeatureGroup.prototype.initialize.call(this,a,b)},animate:function(a,b,c,d){this.eachLayer(function(f){f.animate(a,b,c,d)})},onAdd:function(a){L.FeatureGroup.prototype.onAdd.call(this,a);this._set=this._map._paper.set();for(i in this._layers)this._set.push(this._layers[i]._set)},hover:function(a,b,c,d){this.eachLayer(function(f){f.hover(a,b,c,d)});return this},attr:function(a,b){this.eachLayer(function(c){c.attr(a,
b)});return this}});var k=function(a){return d.FeatureGroup.extend({initialize:function(a,c){this._layers={};this._options=c;this.setLatLngs(a)},setLatLngs:function(b){var c=0,d=b.length;for(this.eachLayer(function(a){c<d?a.setLatLngs(b[c++]):this.removeLayer(a)},this);c<d;)this.addLayer(new a(b[c++],this._options));return this}})};d.MultiPolyline=k(d.Polyline);d.MultiPolygon=k(d.Polygon);d.GeoJSON=d.FeatureGroup.extend({initialize:function(a,b){L.Util.setOptions(this,b);this._geojson=a;this._layers=
{};a&&this.addGeoJSON(a)},addGeoJSON:function(a){var b=a.features,c;if(b){a=0;for(c=b.length;a<c;a++)this.addGeoJSON(b[a])}else b="Feature"===a.type?a.geometry:a,c=d.GeoJSON.geometryToLayer(b,this.options.pointToLayer),this.fire("featureparse",{layer:c,properties:a.properties,geometryType:b.type,bbox:a.bbox,id:a.id,geometry:a.geometry}),this.addLayer(c)}});L.Util.extend(d.GeoJSON,{geometryToLayer:function(a,b){var c=a.coordinates,e=[],f,g,h;switch(a.type){case "Point":return f=this.coordsToLatLng(c),
b?b(f):new d.Marker(f);case "MultiPoint":g=0;for(h=c.length;g<h;g++)f=this.coordsToLatLng(c[g]),f=b?b(f):new d.Marker(f),e.push(f);return new d.FeatureGroup(e);case "LineString":return c=this.coordsToLatLngs(c),new d.Polyline(c);case "Polygon":return c=this.coordsToLatLngs(c,1),new d.Polygon(c);case "MultiLineString":return c=this.coordsToLatLngs(c,1),new d.MultiPolyline(c);case "MultiPolygon":return c=this.coordsToLatLngs(c,2),new d.MultiPolygon(c);case "GeometryCollection":g=0;for(h=a.geometries.length;g<
h;g++)f=this.geometryToLayer(a.geometries[g],b),e.push(f);return new d.FeatureGroup(e);default:throw Error("Invalid GeoJSON object.");}},coordsToLatLng:function(a,b){var c=parseFloat(a[b?0:1]),d=parseFloat(a[b?1:0]);return new L.LatLng(c,d,!0)},coordsToLatLngs:function(a,b,c){var d,f=[],g,h;g=0;for(h=a.length;g<h;g++)d=b?this.coordsToLatLngs(a[g],b-1,c):this.coordsToLatLng(a[g],c),f.push(d);return f}})})();